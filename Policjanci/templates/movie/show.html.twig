{% extends 'base.html.twig' %}

{% block title %}{{ movie.title }} ‚Äì PlusFlix{% endblock %}

{% block body %}
<div class="movie-page">

    <div class="movie-left">
        <img src="{{ movie.image ?? 'https://placehold.co/300x450' }}" class="movie-cover">

        <div class="rating-box">
            <strong>Oceny {{ movie.score ?? '0' }}%</strong>

            <div class="like-icon" onclick="addLike({{ movie.id }})">
                üëç
            </div>

            <span class="like-count" id="likes-{{ movie.id }}">0</span>
        </div>

    </div>

    <div class="movie-right">

        <h1>{{ movie.title }}</h1>

        <div class="movie-meta">
            Rok produkcji: {{ movie.releaseYear }} |
            Gatunek:
            {% for cat in movie.categories %}
                {{ cat.name }}{% if not loop.last %}, {% endif %}
            {% endfor %}
        </div>

        <hr>

        <h3>Opis</h3>
        <p>{{ movie.description ?? 'Brak opisu.' }}</p>

        <h3>Produkcja</h3>
        <p>{{ movie.country ?? 'Brak danych' }}</p>

        <h3>Gdzie obejrzeƒá?</h3>

        {% if movie.services is empty %}
            <p>Brak informacji o dostƒôpnych platformach.</p>
        {% else %}
            <div class="services-row">
                {% for s in movie.services %}
                    <div class="service-item">
                        <img src="{{ asset(s.logoPath) }}" alt="{{ s.fullName }}" class="service-logo">

                    </div>
                {% endfor %}
            </div>
        {% endif %}



        {% if movie.isSeries %}
            <h3>Lista odcink√≥w</h3>
            <p>Brak danych o odcinkach.</p>
        {% endif %}

        <h3>Komentarze</h3>
        <div class="comment-box">
            <input type="text" id="comment-author" placeholder="Pseudonim">
            <textarea id="comment-text" placeholder="Tre≈õƒá komentarza..."></textarea>
            <button onclick="addComment({{ movie.id }})">Dodaj komentarz</button>
        </div>

        <div id="comments-list" class="comments-section">
            <p id="no-comments">Brak komentarzy.</p>
        </div>

    </div>
</div>

<style>
.movie-page {
    display: flex;
    gap: 40px;
    padding: 30px;
}
.movie-left {
    width: 300px;
}
.movie-cover {
    width: 100%;
    border-radius: 6px;
}
.rating-box {
    margin-top: 20px;
    background: #111;
    padding: 10px;
    border-radius: 6px;
    text-align: center;
}
.like-icon {
    font-size: 28px;
    cursor: pointer;
    margin-top: 10px;
}
.movie-right {
    flex-grow: 1;
}
.service-logo {
    width: 50px;
    margin-right: 10px;
    border-radius: 4px;
}
.comment-box input,
.comment-box textarea {
    width: 100%;
    margin-bottom: 10px;
    background: #111;
    border: 1px solid #444;
    padding: 8px;
    color: white;
}
.comment-box button {
    background: #e50914;
    color: white;
    padding: 8px 14px;
    border: none;
    cursor: pointer;
}

// Styl dla splatform
.services-row {
    display: flex;
    gap: 20px;
    margin: 15px 0;
    align-items: center;
}

.service-item {
    text-align: center;
    color: #ccc;
    font-size: 13px;
}

.service-logo {
    width: 60px;
    height: 60px;
    object-fit: contain;
    filter: brightness(1.1);
    transition: transform .2s;
}

.service-logo:hover {
    transform: scale(1.1);
}

</style>

<script>
function addLike(movieId) {

    const key = "likes_" + movieId;
    const pressedKey = key + "_pressed";

    // Pobierz obecnƒÖ liczbƒô
    let current = parseInt(localStorage.getItem(key) || "0");

    // Je≈ºeli ju≈º klikniƒôto wcze≈õniej ‚Äî blokujemy drugi lajk
    if (localStorage.getItem(pressedKey)) {
        return;
    }

    current++;
    localStorage.setItem(key, current);
    localStorage.setItem(pressedKey, "1");

    document.getElementById("likes-" + movieId).textContent = current;
}

// Po za≈Çadowaniu strony ustaw licznik
document.addEventListener("DOMContentLoaded", () => {
    const movieId = {{ movie.id }};
    const key = "likes_" + movieId;

    let current = localStorage.getItem(key) || 0;

    document.getElementById("likes-" + movieId).textContent = current;
});
</script>


<script>
// Komentarze

// üîÑ ≈ÅADOWANIE KOMENTARZY PO WEJ≈öCIU NA STRONƒò
document.addEventListener("DOMContentLoaded", () => {
    loadComments({{ movie.id }});
});


// üìå FUNKCJA DODAWANIA KOMENTARZA
function addComment(movieId) {
    const author = document.getElementById("comment-author").value.trim();
    const text = document.getElementById("comment-text").value.trim();

    if (!author || !text) {
        alert("Wpisz pseudonim i tre≈õƒá komentarza.");
        return;
    }

    const key = "comments_" + movieId;
    const comments = JSON.parse(localStorage.getItem(key) || "[]");

    const newComment = { author, text };
    comments.push(newComment);
    localStorage.setItem(key, JSON.stringify(comments));

    // üî• UKRYJ TEKST ‚ÄûBrak komentarzy‚Äù
    document.getElementById("no-comments").style.display = "none";

    // üî• DODAJ KOMENTARZ NATYCHMIAST BEZ OD≈öWIE≈ªANIA
    const list = document.getElementById("comments-list");

    const div = document.createElement("div");
    div.className = "single-comment";
    div.innerHTML = `
        <strong>${newComment.author}</strong><br>
        ${newComment.text}
    `;

    list.appendChild(div);

    // Czyszczenie p√≥l
    document.getElementById("comment-author").value = "";
    document.getElementById("comment-text").value = "";
}


// üìå FUNKCJA ≈ÅADOWANIA KOMENTARZY PRZY ODSWIE≈ªENIU
function loadComments(movieId) {
    const key = "comments_" + movieId;
    const comments = JSON.parse(localStorage.getItem(key) || "[]");

    const list = document.getElementById("comments-list");

    if (comments.length === 0) {
        document.getElementById("no-comments").style.display = "block";
        return;
    }

    document.getElementById("no-comments").style.display = "none";

    comments.forEach(c => {
        const div = document.createElement("div");
        div.className = "single-comment";
        div.innerHTML = `
            <strong>${c.author}</strong><br>
            ${c.text}
        `;
        list.appendChild(div);
    });
}

</script>


{% endblock %}
